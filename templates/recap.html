{% extends 'base.html' %}

{% block title %}Recap - The Exposure Triangle{% endblock %}

{% block content %}
<div class="lesson-container">
  <h1 class="lesson-title">Recap</h1>
  
  <!-- Two-column layout: summary on left, visual on right -->
  <div class="recap-main">
    <div class="recap-summary">
      <div class="recap-text-card">
        <p>The Exposure Triangle combines ISO, Shutter Speed, and Aperture. Adjust one element and you often must tweak another to maintain exposure. Higher ISO brightens but increases noise, faster shutter freezes action but reduces light, and wider aperture provides shallow depth of field and more light.</p>
      </div>
    </div>
    <div class="recap-visual">
      <img src="{{ url_for('static', filename='images/triangle.jpg') }}" alt="Exposure Triangle" class="triangle-img-large" id="interactive-triangle-img">
    </div>
  </div>

  <!-- Unified slider control panel below image -->
  <div class="interactive-controls-panel">
    <div class="slider-row">
      <div class="slider-label">ISO</div>
      <input type="range" id="iso-slider" class="interactive-slider" min="1" max="5" value="3">
      <div class="slider-values">
        <span>100</span><span>200</span><span>400</span><span>800</span><span>1600</span>
      </div>
    </div>
    <div class="slider-row">
      <div class="slider-label">Shutter Speed</div>
      <input type="range" id="shutter-slider" class="interactive-slider" min="1" max="5" value="3">
      <div class="slider-values">
        <span>1s</span><span>1/30s</span><span>1/125s</span><span>1/500s</span><span>1/2000s</span>
      </div>
    </div>
    <div class="slider-row">
      <div class="slider-label">Aperture</div>
      <input type="range" id="aperture-slider" class="interactive-slider" min="1" max="5" value="3">
      <div class="slider-values">
        <span>f/2.8</span><span>f/4</span><span>f/8</span><span>f/11</span><span>f/16</span>
      </div>
    </div>
    <div class="slider-row">
      <div class="slider-label">Exposure Compensation</div>
      <input type="range" id="ev-slider" class="interactive-slider" min="-2" max="2" value="0" step="1">
      <div class="slider-values">
        <span>-2 EV</span><span>-1 EV</span><span>0 EV</span><span>+1 EV</span><span>+2 EV</span>
      </div>
    </div>
  </div>

  <!-- Navigation buttons -->
  <div class="lesson-nav">
    <a href="{{ url_for('learn', lesson_num=3) }}" class="nav-btn">Previous</a>
    <a href="{{ url_for('quiz_format') }}" class="nav-btn test-btn">Test Yourself</a>
    <a href="{{ url_for('learn', lesson_num=4) }}" class="nav-btn">Next</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const isoSlider = document.getElementById('iso-slider');
  const shutterSlider = document.getElementById('shutter-slider');
  const apertureSlider = document.getElementById('aperture-slider');
  const evSlider = document.getElementById('ev-slider');
  const triangleImage = document.getElementById('interactive-triangle-img');
  const overlay = document.createElement('div');
  overlay.className = 'interactive-overlay';
  triangleImage.parentElement.appendChild(overlay);

  const valuesMap = {
    'iso-slider': ['100','200','400','800','1600'],
    'shutter-slider': ['1s','1/30s','1/125s','1/500s','1/2000s'],
    'aperture-slider': ['f/2.8','f/4','f/8','f/11','f/16'],
    'ev-slider': ['-2 EV','-1 EV','0 EV','+1 EV','+2 EV']
  };

  function updateImage() {
    const isoVal = parseInt(isoSlider.value);
    const shutterVal = parseInt(shutterSlider.value);
    const apertureVal = parseInt(apertureSlider.value);
    const evVal = parseInt(evSlider.value);
    const isoFactor = (isoVal - 1) / 4;
    const brightness = 1 + (isoFactor * 0.5) + (evVal * 0.3);
    const motionBlur = shutterVal < 3 ? (3 - shutterVal) * 1.5 : 0;
    const depthBlur = apertureVal < 3 ? (3 - apertureVal) * 2 : 0;

    triangleImage.style.filter = `brightness(${brightness}) blur(${motionBlur}px)`;
    overlay.style.backdropFilter = `blur(${depthBlur}px)`;
  }

  [isoSlider, shutterSlider, apertureSlider, evSlider].forEach(slider => {
    slider.addEventListener('input', function() {
      const labels = document.querySelectorAll(`#${this.id} ~ .slider-values span`);
      labels.forEach((span, idx) => {
        span.classList.toggle('active-value', idx + 1 === (this.id==='ev-slider'? this.value*1+3 : parseInt(this.value)));
      });
      this.parentElement.querySelector('label span').textContent = valuesMap[this.id][parseInt(this.value) - (this.id==='ev-slider'? -2 : 1)];
      updateImage();
    });
  });

  updateImage();
});
</script>
{% endblock %} 